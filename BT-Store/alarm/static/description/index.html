<section class="oe_page">
    <div>
        <h2 class="oe_slogan" style="color:#875A7B; font-weight: bold">Alarms / Reminders</h2>
        <h3 class="oe_slogan">Create alarms for any record and send reminders to the appropriate users when certain
            conditions are met</h3>

        <img src="alarm.png" class="oe_screenshot" style="width: 100%">
    </div>

    <div>
        <h2 class="oe_slogan" style="color:#875A7B;">Summary</h2>

        <div class="text-justify">
            <p>
                Create an alarm for any record model, specify when the alarm should generate notifications and which
                users are to be notified.
            </p>

            <p>
                For example, we can create the following alarm:
            </p>

            <ol>
                <li>Record model? Project Task</li>
                <li>When must the alarm generate notifications? Two days before the deadline of the task</li>
                <li>Which user(s) are to be notified? The user responsible for the task</li>
            </ol>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_example.png" class="oe_screenshot" style="width: 100%"/>
            </div>

            <p>
                As a result, each project task with a deadline taking place in 2 days will trigger the generation of an
                alarm notification (a reminder) for the user that is set as responsible within the task. Note that the
                user can access the task directly from the notification.
            </p>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_notification_example.png" class="oe_screenshot" style="width: 100%"/>
            </div>
        </div>
    </div>

    <div>
        <h2 class="oe_slogan" style="color:#875A7B;">Alarm Notifications - How To</h2>

        <div class="text-justify">
            <p>
                All users belonging to the <i>Alarms / Notification User</i> group have access to the
                <i>Alarm Notifications</i> area, where they can see all their notifications. Users belonging to the
                <i>Alarms / Manager</i> group can, additionally, see the notifications of other users.
            </p>

            <div class="oe_mt32 oe_mb32 oe_picture text-center">
                <img src="alarm_notification_user_group.png"/>
            </div>

            <p>
                By default, the list view shows only the notifications of the current user that are active and open.
                However, the filters can be modified to adapt the results to the user's needs.
            </p>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_notification_list.png" class="oe_screenshot" style="width: 100%"/>
            </div>

            <p>
                An alarm notification contains the following information:
            </p>

            <ul>
                <li><b>Name</b>: this is the name of the alarm that triggered the generation of this notification.</li>
                <li><b>Generated for</b>: the user to whom this notification belongs.</li>
                <li><b>Record</b>: link to the record that triggered the generation of this notification.</li>
                <li>
                    <b>Active from</b>: the date from which the notification is considered active. By default, the date
                    when the notification was generated is set. However, a user can move this date into the future to
                    indicate that the notification is to be handled in the future.
                </li>
                <li><b>Notification Message</b>: some information provided by the alarm.</li>
                <li><b>Notes</b>: text field for the user to note down any information they want.</li>
                <li>
                    <b>State</b>: indicates if the notification is open (to be handled), closed (handled) or cancelled.
                    By default, all notification are generated in the open state. However, a user can change the state
                    at any time.
                </li>
            </ul>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_notification_form.png" class="oe_screenshot" style="width: 100%"/>
            </div>
        </div>
    </div>

    <div>
        <h2 class="oe_slogan" style="color:#875A7B;">Alarms - How To</h2>

        <div class="text-justify">
            <p>
                All users belonging to the <i>Alarms / Alarm User</i> group have access to the <i>Alarms</i> area, where
                they can manage all their alarms. Users belonging to the <i>Alarms / Manager</i> group can,
                additionally, manage the alarms of other users.
            </p>

            <div class="oe_mt32 oe_mb32 oe_picture text-center">
                <img src="alarm_user_group.png"/>
            </div>

            <p>
                Additionally, these users have access to a shortcut action named <i>Create Alarm</i> placed in the
                <i>Action</i> drop-down available in all list views when one or more records are selected and in all
                form views. Such an action allows the user to create very easily an alarm exclusively for the selected
                records.
            </p>

            <div class="oe_mt32 oe_mb32 oe_picture text-center">
                <img src="create_alarm_action.png" class="oe_screenshot" style="width: 100%"/>
            </div>

            <p>
                By default, the alarms list view shows only the alarms created by the current user that are draft or
                done. However, the filters can be modified to adapt the results to the user's needs.
            </p>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_list.png" class="oe_screenshot" style="width: 100%"/>
            </div>

            <p>
                An alarm contains the following information:
            </p>

            <ul>
                <li>
                    <b>Name</b>: short descriptive name for the alarm. This name is assigned to all notifications
                    generated by this alarm.
                </li>
                <li><b>Description</b>: further details to better understand the purpose of the alarm.</li>
                <li><b>Created by</b>: the user that created the alarm and therefore, the alarm owner.</li>
                <li>
                    <b>Triggered on</b>: the date/time on which this alarm was last triggered. Alarms are normally
                    triggered every day in the early morning by a scheduled action. However, a user can also
                    trigger it manually by means of the <i>Trigger Alarm</i> button. Note that even if the alarm is
                    triggered multiple times in a row, the same notification will not be generated more than once.
                </li>
                <li>
                    <b>Model</b>: the type of record to be checked in order to decide if a notification must be
                    generated or not.</li>
                <li>
                    <b>Model Domain</b>: python domain used to select only records with certain characteristics. For
                    example, we can configure the alarm to generate notifications only for records in the draft state
                    and whose creator is me by using the following domain:
                    <span style="font-family: monospace">['&', ('state', '=', 'draft'), ('create_uid', '=', my_uid)]</span>.
                    The following variables and libraries are available:
                    <ul>
                        <li>my_uid: variable with my user ID.</li>
                        <li>date: library to manage dates (e.g., date.today())</li>
                        <li>datetime: library to manage date with times (e.g., datetime.now())</li>
                        <li>timedelta: library to manage time deltas (e.g., date.today() + timedelta(days=2))</li>
                    </ul>
                </li>
                <li>
                    <b>Date Field</b>: date(time) field within the specified <i>Model</i> whose check may trigger the
                    generation of a notification. When checking this field, if time information is present, it is
                    simply ignored (e.g., "2017-01-25 09:30:00" is treated as "2017-01-25").
                </li>
                <li>
                    <b>Number of Days</b>: a negative integer indicates that a notification will be generated this
                    number of days before the date set in <i>Date Field</i>; a positive integer indicates that a
                    notification will be generated this number of days after the date set in <i>Date Field</i>; a zero
                    indicates that a notification will be generated right on the date set in <i>Date Field</i>.
                </li>
                <li>
                    <b>Notify Only Me</b>: this flag indicates whether I will be the only person to be notified or not.
                    Note that only users belonging to the <i>Alarms / Manager</i> group can actually create alarms
                    that notify other users.
                </li>
                <li>
                    <b>User Field</b>: the field within the specified <i>Model</i> containing the user(s) to be
                    notified. If <i>Notify Only Me</i> is set, I will be the only person to be notified but I must be
                    also the user specified in this field.</li>
                <li><b>Explicit Users to Notify</b>: static set of users that must always be notified.</li>
                <li>
                    <b>Notification Message</b>: information that will be provided to the notified user.
                    Here we can provide static information but also dynamic information. To provide dynamic information
                    we must use MAKO templates* (same technique as the one used in email templates). For example, if we
                    have an alarm for project tasks and we want to include in the notification message the name of the
                    project manager, we can use the template
                    <span style="font-family: monospace">${object.manager_id.name}</span>.
                    To verify that the template is correct and that the notification message looks like desired, we can
                    use the <i>Preview Notification Message</i> button.
                </li>
                <li>
                    <b>State</b>: indicates if the alarm is draft (not ready to be automatically triggered),
                    done (ready to be automatically triggered) or cancelled. Note that any alarm can be manually
                    triggered by means of the <i>Trigger Alarm</i> button.
                </li>
            </ul>

            <p>
                * Brief explanation about MAKO templates: all MAKO templates are represented with
                <span style="font-family: monospace">${...}</span>. Within the braces we can provide any python code,
                taking into account that we can only access a limited set of functions and variables. The most
                important variable we have is <span style="font-family: monospace">object</span>, which represents the
                record triggering the alarm (in our example, a project task).
            </p>

            <div class="oe_mt32 oe_mb32">
                <img src="alarm_form.png" class="oe_screenshot" style="width: 100%"/>
            </div>
        </div>

        <div>
            <h2 class="oe_slogan" style="color:#875A7B;">Configuration by Admin</h2>

            <div class="text-justify">
                <p>
                    Firstly, the admin must assign the appropriate <b><i>Alarms</i> security group</b> to all users. A
                    description of each security group is provided below:
                </p>

                <ul>
                    <li><b>No Group</b>: the user has no access to the <i>Alarms</i> module.</li>
                    <li><b>Notification User</b>: the user has access to their own alarm notifications.</li>
                    <li>
                        <b>Alarm User</b>: the user has access to their own alarms and notifications. Their alarms can
                        only be configured to notify themselves.</li>
                    <li>
                        <b>Manager</b>: the user has access to all alarms and notifications. Their alarms can be
                        configured to notify anybody.
                    </li>
                </ul>

                <div class="oe_mt32 oe_mb32 oe_picture text-center">
                    <img src="alarm_notification_user_group.png"/>
                </div>

                <p>
                    Secondly, the admin must make sure that the <b>scheduled action in charge of triggering done
                    alarms</b> is properly configured (i.e., active and at least, executed once a day). By default, the
                    execution is scheduled to take place every day at 3 am. Note that even if the alarm is triggered
                    multiple times a day, the same notification will not be generated more than once.
                </p>

                <div class="oe_mt32 oe_mb32 oe_picture text-center">
                    <img src="cron_notify_1.png" class="oe_screenshot" style="width: 100%"/>
                </div>

                <div class="oe_mt32 oe_mb32 oe_picture text-center">
                    <img src="cron_notify_2.png" class="oe_screenshot" style="width: 100%"/>
                </div>

                <p>
                    Finally, the admin must also make sure that the <b>scheduled action in charge of deleting closed
                    and cancelled notifications</b> is properly configured. By default, this scheduled action is active,
                    set to be executed every day at 5 am, and configured to delete all closed and cancelled
                    notifications that have been active for more than 15 days. Note that the admin can deactivate this
                    scheduled action in order to prevent notifications from being automatically deleted or modify the
                    "15 days" argument to some other value (a positive integer must be provided).
                </p>

                <div class="oe_mt32 oe_mb32 oe_picture text-center">
                    <img src="cron_delete_1.png" class="oe_screenshot" style="width: 100%"/>
                </div>

                <div class="oe_mt32 oe_mb32 oe_picture text-center">
                    <img src="cron_delete_2.png" class="oe_screenshot" style="width: 100%"/>
                </div>
            </div>
        </div>
</section>
